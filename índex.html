
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rifa Los Compas</title>

<style>
body{
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  margin:0;
  padding:20px;
  color:white;
  text-align:center;
}

.container{
  max-width:1000px;
  margin:auto;
}

h1{
  margin-bottom:5px;
  font-size:28px;
}

.descripcion{
  font-size:15px;
  opacity:.9;
  margin-bottom:20px;
}

.card{
  background:white;
  color:#333;
  border-radius:15px;
  padding:20px;
  margin-bottom:25px;
  box-shadow:0 10px 25px rgba(0,0,0,.3);
}

.boletos{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(60px,1fr));
  gap:8px;
}

.boleto{
  padding:10px;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
  background:#f2f2f2;
  transition:.2s;
}

.boleto:hover{
  transform:scale(1.05);
}

.boleto.seleccionado{
  background:#00c853;
  color:white;
}

.boleto.vendido{
  background:#ccc;
  color:#666;
  cursor:not-allowed;
}

.resumen{
  font-size:16px;
  margin-top:10px;
}

.preview{
  margin-top:15px;
  font-size:15px;
  color:#00c853;
  font-weight:bold;
}

input{
  padding:12px;
  width:260px;
  border-radius:8px;
  border:none;
  margin-top:15px;
  font-size:15px;
}

button{
  margin-top:15px;
  padding:14px 25px;
  border:none;
  border-radius:10px;
  background:#00c853;
  color:white;
  font-size:16px;
  cursor:pointer;
  transition:.2s;
}

button:hover{
  background:#00a843;
}

.totalBox{
  margin-top:10px;
  font-weight:bold;
  font-size:18px;
}

</style>
</head>

<body>

<div class="container">

<h1>ğŸŸï¸ RIFA LOS COMPAS ğŸŸï¸</h1>

<p class="descripcion">
Por cada boleto obtienes <strong>4 nÃºmeros EXTRA GRATIS</strong> ğŸ
</p>

<div class="card">

<div class="boletos" id="boletos"></div>

<div class="resumen">
Boletos seleccionados: <span id="cantidad">0</span>
<div class="totalBox">Total: $<span id="total">0</span></div>
</div>

<div class="preview" id="previewExtras"></div>

<input type="text" id="nombreCliente" placeholder="Tu nombre completo">

<br>

<button id="btnPagar" onclick="pagar()">Finalizar Compra</button>

</div>

</div>

<script>

const PRECIO_BOLETO = 50;
const TOTAL_BOLETOS = 200;

const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbzTOWYzJCyo8by2wIQVea_okYTKMMmzDyJhNWfAEF4l44J9IRqsw-T6JpRNzP7k6fE/exec";

const contenedor = document.getElementById("boletos");
const seleccionados = new Set();
let vendidos = [];

fetch(URL_SCRIPT)
.then(res=>res.json())
.then(data=>{
  vendidos=data;
  generarBoletos();
});

function generarBoletos(){
  for(let i=0;i<TOTAL_BOLETOS;i++){
    const num=i.toString().padStart(3,"0");
    const div=document.createElement("div");
    div.className="boleto";
    div.textContent=num;

    if(vendidos.includes(num)){
      div.classList.add("vendido");
    }else{
      div.onclick=()=>toggle(num,div);
    }

    contenedor.appendChild(div);
  }
}

function toggle(num,div){
  if(seleccionados.has(num)){
    seleccionados.delete(num);
    div.classList.remove("seleccionado");
  }else{
    seleccionados.add(num);
    div.classList.add("seleccionado");
  }
  actualizarResumen();
}

function actualizarResumen(){
  document.getElementById("cantidad").textContent=seleccionados.size;
  document.getElementById("total").textContent=
  seleccionados.size*PRECIO_BOLETO;

  if(seleccionados.size>0){
    document.getElementById("previewExtras").innerHTML=
    "ğŸ Tus nÃºmeros EXTRA se mostrarÃ¡n antes de enviar a WhatsApp";
  }else{
    document.getElementById("previewExtras").innerHTML="";
  }
}

function pagar(){

  if(seleccionados.size===0){
    alert("Selecciona al menos un boleto");
    return;
  }

  const nombre=document.getElementById("nombreCliente").value.trim();

  if(nombre===""){
    alert("Escribe tu nombre");
    return;
  }

  const boletosArray=Array.from(seleccionados);

  fetch(URL_SCRIPT,{
    method:"POST",
    body:JSON.stringify({
      nombre:nombre,
      boletos:boletosArray
    })
  })
  .then(res=>res.json())
  .then(data=>{

    const extras=data.gratis || [];

    // MOSTRAR EN PANTALLA ANTES
    document.getElementById("previewExtras").innerHTML=
    `ğŸ NÃºmeros EXTRA: ${extras.join(", ")}`;

    setTimeout(()=>{

      const mensaje =
`ğŸŸï¸ *RIFA LOS COMPAS*

Hola! RealicÃ© la siguiente reserva:

â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ« *BOLETOS:* ${boletosArray.join(", ")}

ğŸ *EXTRAS GRATIS:* ${extras.join(", ")}

ğŸ’° *TOTAL:* $${data.total}

ğŸ‘¤ *Nombre:* ${nombre}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EnvÃ­o comprobante de pago enseguida.`;

      window.open(
        "https://wa.me/527421199270?text="+
        encodeURIComponent(mensaje),
        "_blank"
      );

      location.reload();

    },1500);

  });

}

</script>

</body>
</html>
